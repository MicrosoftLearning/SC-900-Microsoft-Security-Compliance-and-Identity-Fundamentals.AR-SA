<!---
---
التمرين المعملي: العنوان: 'استكشاف مجموعات أمان شبكة Azure (NSG)' مسار التعلم/الوحدة النمطية/الوحدة: 'مسار التعلم: وصف إمكانات حلول الأمان من Microsoft؛ الوحدة النمطية 1: وصف إمكانات الأمان الأساسية في Azure؛ الوحدة 6: وصف مجموعات أمان شبكة Azure'
---
--->

# نشاط معملي: استكشاف مجموعات أمان الشبكة (NSGs) في Azure

يقوم هذا التمرين المعملي بتعيين محتوى Learn التالي:

- مسار التعلم: وصف إمكانيات حلول الأمان من Microsoft
- الوحدة النمطية: وصف إمكانات الأمان الأساسية في Azure
- الوحدة: وصف مجموعات أمان شبكة Azure

## سيناريو النشاط المعملي

في هذا النشاط المعملي، ستستكشف وظيفة مجموعات أمان الشبكة في Azure.  ستقوم بذلك عن طريق إنشاء مجموعة أمان شبكة (NSG) وتعيين مجموعة أمان شبكة إلى واجهة جهاز ظاهري (VM) موجود مسبقًا.  بمجرد التكوين، ستراقب قواعد الوارد والصادر الافتراضية، وتنشئ قواعد جديدة وتختبرها.  في هذا النشاط المعملي، يتم إنشاء الجهاز الظاهري الذي ستستخدمه مع مجموعة أمان الشبكة من أجلك، لذلك ستقوم أولاً بعرض بعض المعلومات المرتبطة بهذا الجهاز الظاهري.
  
**الزمن المقدر**: من 30 إلى 45 دقيقة

### المهمة 1

في هذه المهمة، ستقوم بعرض بعض المعلمات المقترنة بالجهاز الظاهري التي تم إنشاؤها للاستخدام مع هذا النشاط المعملي.

1. افتح مستعرض Microsoft Edge.  في شريط العناوين، أدخل **https://portal.azure.com**.

1. سجل الدخول باستخدام بيانات اعتماد المسؤول خاصتك.
    1. في نافذة Sign-in، أدخل اسم المستخدم الذي يوفره موفر استضافة النشاط المعملي ثم حدد **Next**.
    1. أدخل كلمة مرور المسؤول التي يجب أن يوفرها موفر استضافة النشاط المعملي الخاص بك. حدد **"Sign in"**.
    1. عند مطالبتك بالبقاء مسجلاً للدخول، حدد **Yes**.

1. في أعلى الصفحة، أسفل المكان المذكور فيه Azure Services، حدد **Virtual Machines**.  إذا كنت لا تراها مدرجة، ففي مربع البحث، في الشريط الأزرق أعلى الصفحة بجوار المكان المذكور فيه Microsoft Azure، أدخِل **Virtual Machines** ثم حدد **Virtual Machines** من نتائج البحث.

1. من صفحة Virtual machines، حدد الجهاز الظاهري المدرج **SC900-WinVM**.

1. أنت الآن في صفحة SC900-WinVM.  لاحظ بعض المعلومات الأساسية حول الجهاز الظاهري.

1. من أعلى الصفحة، حدد **Connect**.  حدد خيار **التحقق من الوصول**، المدرج ضمن عنوان IP.  سيتم إجراء هذا الفحص باستخدام المنفذ 3389، وهو منفذ اتصال RDP.  يجب أن تشاهد الرسالة "لا يمكن التحقق".  من مربع RDP الأصلي، انقر فوق **تحديد**.  في النافذة التي تفتح، ضمن "1 تكوين المتطلبات الأساسية ل RDP الأصلي"، يجب أن ترى "يحتاج Azure إلى تكوين بعض الميزات من أجل الاتصال بالجهاز الظاهري".  في المهمة التالية، ستقوم بإعداد NSG للسماح صراحة باتصال RDP.


1. من لوحة التنقل اليسرى، حدد **Networking**.  
    1. طريقة العرض الافتراضية هي inbound port rules.  لاحظ أنه لم يتم تكوين مجموعات أمان الشبكة لواجهة الشبكة لهذا الجهاز الظاهري.  وينطبق الشيء نفسه إذا حددت Outbound port rules.
    1. حدد **Effective security rules** بجوار المكان المذكور فيه Network interface.  لاحظ أنه مذكور "No network security groups or applications security groups are associated with the network interface".

1. اترك علامة تبويب المستعرض هذه مفتوحة.


### المهمة 2

في هذه المهمة، ستنشئ مجموعة أمان شبكة، وتعين واجهة الشبكة للجهاز الظاهري إلى مجموعة أمان الشبكة تلك، وتنشئ قاعدة وارد جديدة لنقل بيانات RDP.

1. من علامة التبويب NSG المفتوحة، *انقر بزر الماوس الأيمن فوق* الارتباط **الصفحة الرئيسية** في أعلى الصفحة وحدد **فتح ارتباط في علامة تبويب جديدة** لفتح صفحة أخرى إلى خدمات Azure.

1. في شريط البحث الأزرق أعلى الصفحة، أدخل **مجموعات أمان الشبكة** ، ومن النتائج، حدد **مجموعات أمان الشبكة**. لا تحدد *مجموعات أمان الشبكة (الكلاسيكية).*

1. من أعلى صفحة مجموعات أمان الشبكة، حدد **+ إنشاء**.

1. في علامة تبويب الأساسيات في صفحة إنشاء مجموعة أمان الشبكة، حدد الإعدادات التالية:
    1. الاشتراك: اترك القيمة الافتراضية (هذا هو اشتراك Azure الذي يوفره المضيف المعملي المعتمد)
    1. مجموعة الموارد:  **LabsSC900**
    1. الاسم:  **NSG-SC900**
    1. Region: اترك الإعداد الافتراضي.
    1. حدد **مراجعة + إنشاء**، ثم حدد **إنشاء**.

1. بمُجرد اكتمال عملية النشر، اختر ⁧**⁩Go to resource⁧**⁩.

1. في أعلى الصفحة أسفل المكان المذكور فيه Essentials، سترى بعض المعلومات الأساسية حول مجموعة أمان الشبكة التي أنشأتها.  نقطتان يجب ملاحظتها هما أنه لا توجد قواعد أمان مخصصة ولا توجد شبكات فرعية ولا واجهات شبكة مرتبطة بمجموعة أمان الشبكة هذه.  على الرغم من عدم وجود قواعد أمان مخصصة، إلا أن هناك قواعد افتراضية للوارد والصادر مضمنة مع كل مجموعة أمان شبكة، كما هو موضح في الصفحة.  راجع قواعد الوارد والصادر. ترفض قواعد الوارد الافتراضية جميع عمليات نقل البيانات الواردة التي ليست من شبكة ظاهرية أو Azure load balancer.  ترفض القواعد الصادرة جميع نسبة استخدام الشبكة الصادرة باستثناء نسبة استخدام الشبكة بين الشبكات الظاهرية وحركة المرور الصادرة إلى الإنترنت.

1. من جزء التنقّل الأيسر في صفحة NSG-SC900، ضمن الإعدادات، حدد **واجهات الشبكة**.
    1. حدد **+ Associate.**
    2. في حقل اقترانات واجهة الشبكة، حدد **السهم لأسفل**، وحدد **sc900-winvmXXX**، ثم حدد **موافق** في أسفل النافذة. بمجرد ربط الواجهة بمجموعة أمان الشبكة، ستظهر في القائمة.

1. من جزء التنقل الأيسر، حدد **Inbound security rules**.

1. ترفض قواعد الوارد الافتراضية جميع عمليات نقل البيانات الواردة التي ليست من شبكة ظاهرية أو Azure load balancer، لذلك تحتاج إلى إعداد قاعدة للسماح بنقل بيانات RDP الواردة (نقل البيانات على المنفذ 3389). تذكر أنه لا يمكنك إزالة القواعد الافتراضية، ولكن يمكنك تجاوزها بإنشاء قواعد ذات أولويات أعلى.

1. من أعلى الصفحة، حدد **Add**. في نافذة «Add inbound security rule»، حدد الإعدادات التالية:
    1. المصدر:  **أي**
    1. نطاقات منافذ المصادر: **\***
    1. الوجهة:  **أي**
    1. الخدمة:  **RDP**
    1. الإجراء:  **السماح**
    1. Priority:  **1000**. القواعد ذات الأرقام الأقل لها أولوية أعلى وتتم معالجتها أولا.
    1. Name: اترك الاسم الافتراضي أو أنشئ الاسم الوصفي الخاص بك.
    1. لاحظ علامة التحذير في أسفل الصفحة.  نحن نستخدم RDP فقط لأغراض الاختبار ولتوضيح وظائف مجموعة أمان الشبكة.
    1. حدد **إضافة**

1. بمجرد توفير القاعدة، ستظهر في قائمة القواعد الواردة (قد تحتاج إلى تحديث الشاشة).

1. اترك علامة تبويب المستعرض هذه مفتوحة.  

### الهمة 3

في هذه المهمة، ستختبر قاعدة مجموعة أمان الشبكة للوارد التي تم إنشاؤها حديثًا للتأكد من أنه يمكنك إنشاء اتصال سطح مكتب بعيد (RDP) بالجهاز الظاهري.  بمجرد داخل الجهاز الظاهري، ستعمل على التحقق من الاتصال الصادر بالإنترنت من الجهاز الظاهري.

1. افتح علامة تبويب SC900-WinVM – Microsoft Azure في المستعرض. إذا قمت مسبقا بإغلاق علامة تبويب المستعرض، فافتح علامة تبويب مستعرض جديدة، وأدخل **https://portal.azure.com**، وحدد **الأجهزة الظاهرية**، ثم حدد الجهاز الظاهري، **SC900-WinVM**.

1. حدد **اتصال** من لوحة التنقل اليسرى.

1. حدد **التحقق من الوصول** (تحقق من تعيين المنفذ إلى 3389).  يجب أن تظهر الحالة على أنها "يمكن الوصول إليها".

1. اتصل الآن مباشرة بالجهاز الظاهري بالنقر فوق **تحديد** في المربع الذي يشير إلى RDP الأصلي.
   
    1. من نافذة RDP الأصلية التي تفتح، حدد **تنزيل ملف RDP**.
    1. إذا ظهر تحذير تنزيل، فحدد **الاحتفاظ**، ثم في النافذة المنبثقة التي تظهر، حدد **فتح ملف**.
    1. يتم فتح نافذة اتصال سطح المكتب البعيد؛ حدد **Connect**.
    1. سيُطلب منك بيانات الاعتماد الخاصة بك.  أدخل اسم المستخدم وكلمة المرور للجهاز الظاهري (راجع علامة تبويب الموارد في لوحة تعليمات المختبر).
    1. تفتح نافذة اتصال سطح المكتب البعيد تشير إلى: *لا يمكن التحقق من هوية الكمبيوتر البعيد.  هل تريد الاتصال على أي حال؟*  حدد **نعم**.

1. أنت الآن متصل بالجهاز الظاهري. في هذه الحالة كان بإمكانك الاتصال بالجهاز الافتراضي لأن قاعدة نسبة استخدام الشبكة الواردة التي أنشأتها تسمح بنسبة استخدام الشبكة الواردة إلى الجهاز الظاهري عبر بروتوكول سطح المكتب البعيد.  بعد بضع ثوان على شاشة الترحيب، قد ترى نافذة لاختيار إعدادات الخصوصية لجهازك، حدد **قبول**.  إذا ظهرت نافذة الشبكات، فحدد **لا**.

1. باستخدام الجهاز الظاهري في جلسة RDP وتشغيله، اختبر الاتصال الصادر بالإنترنت من الجهاز الظاهري.
    1. من الجهاز الظاهري المفتوح، حدد **Microsoft Edge** لفتح المستعرض.  نظرًا لأن هذه هي المرة الأولى التي تفتح فيها Microsoft Edge، فقد تحصل على نافذة منبثقة، حدد **Start without your data**، ثم حدد **Continue without this data**، ثم حدد **Confirm and start browsing**.
    1. أدخِل **www.bing.com** في شريط عنوان المستعرض وتأكد من قدرتك على الاتصال بمحرك البحث.
    1. بمجرد التأكد من أنه يمكنك الوصول إلى www.bing.com، أغلق نافذة المستعرض في الجهاز الظاهري، ولكن اترك الجهاز الظاهري مفتوحًا.

1. قم بتصغير الجهاز الظاهري عن طريق تحديد التسطير السفلي **_** في علامة التبويب الزرقاء التي تعرض عنوان IP الخاص بالجهاز الظاهري. هذا يعيدك إلى صفحة SC900-WinVM \| Connect.

1. احتفظ بعلامة تبويب المستعرض مفتوحة؛ ستستخدمه في المهمة التالية.

### المهمة 4

في المهمة السابقة، تأكدت من أنه يمكنك إنشاء اتصال RDP بالجهاز الظاهري. بمجرد دخولك إلى الجهاز الظاهري، تأكد أيضا من أنه يمكنك إنشاء اتصال صادر بالإنترنت.  تم السماح بنسبة استخدام شبكة الإنترنت الصادرة لأن القواعد الصادرة الافتراضية لمجموعة أمان الشبكة تسمح بنسبة استخدام الشبكة الصادرة عبر الإنترنت.  في هذه المهمة، ستنتقل إلى عملية إنشاء قاعدة صادرة مخصصة لحظر نسبة استخدام الشبكة الصادرة عبر الإنترنت واختبار هذه القاعدة.

1. يجب أن تكون على صفحة SC900-WinVM \| Connect. من لوحة التنقل اليسرى، حدد **Networking**. إذا قمت مسبقًا بإغلاق علامة تبويب المستعرض، فحدد شريط البحث الأزرق أعلى الصفحة وحدد Virtual machines، ثم حدد الجهاز الظاهري، **SC900-WinVM**، ثم حدد **Networking**.

1. حدد علامة التبويب **Outbound port rules**.  سترى قواعد الصادر الافتراضية.  لاحظ القاعدة الافتراضية "AllowInternetOutBound". تسمح هذه القاعدة بجميع نسبة استخدام الشبكة الصادرة عبر الإنترنت. لا يمكنك إزالة القاعدة الافتراضية، ولكن يمكنك تجاوزها بإنشاء قواعد ذات أولويات أعلى. من الجانب الأيمن من الصفحة، حدد إضافة **قاعدة منفذ الصادر**.

1. في صفحة إضافة قاعدة أمان الصادر، حدد الإعدادات التالية:
    1. المصدر:  **أي**
    1. نطاقات منفذ المصدر: **\***
    1. الوجهة:  **علامة الخدمة**
    1. علامة خدمة الوجهة:  **الإنترنت**
    1. الخدمة:  **مخصص** (اترك الإعداد الافتراضي)
    1. نطاقات منفذ الوجهة:  **\*** (تأكد من وضع علامة نجمية في حقل نطاقات منفذ الوجهة)
    1. البروتوكول: **أي**
    1. الإجراء: **الرفض**
    1. Priority:  **1000**
    1. Name: اترك الاسم الافتراضي أو أنشئ الاسم الوصفي الخاص بك.
    1. حدد **إضافة**

1. بمجرد توفير القاعدة، ستظهر في قائمة قواعد الصادر.  على الرغم من ظهوره في القائمة، إلا أنه سيستغرق بضع دقائق حتى يصبح ساريًا (انتظر بضع دقائق قبل متابعة الخطوات التالية).  


1. ارجع إلى الجهاز الظاهري (يجب عرض أيقونة RDP للجهاز الظاهري على شريط المهام أسفل الصفحة).

1. افتح متصفح Microsoft Edge على جهازك الظاهري وأدخِل **www.bing.com**. لا ينبغي عرض الصفحة. إذا كنت قادرا على الاتصال بالإنترنت وتحققت من تعيين جميع معلمات القاعدة الصادرة بشكل صحيح، فمن المحتمل أن يستغرق الأمر بضع دقائق حتى تسري القاعدة.  أغلق المستعرض، انتظر بضع دقائق وحاول مرة أخرى. قد تواجه اشتراكات Azure في بيئة المختبر تأخيرات أطول من المعتاد.


1. أغلق اتصال سطح المكتب البعيد، عن طريق تحديد **X** في أعلى منتصف الصفحة حيث يظهر عنوان IP.  تظهر نافذة منبثقة تظهر Your remote session will be disconnected. حدد "**OK**".

1. من الزاوية العلوية اليمنى من النافذة، أسفل الشريط الأزرق حيث يظهر Microsoft Azure، حدد **الصفحة الرئيسية** للعودة إلى الصفحة الرئيسية لخدمات Azure.

1. احتفظ بعلامة تبويب Azure مفتوحة على المستعرض.

### مراجعة

في هذا التمرين المعملي، تجولت في عملية إعداد مجموعة أمان شبكة (NSG)، وربط مجموعة أمان الشبكة هذه بواجهة شبكة الجهاز الظاهري، وإضافة قواعد جديدة إلى NSG للسماح بنسبة استخدام الشبكة RDP الواردة وحظر حركة مرور الإنترنت الصادرة.
